<div class="modal-dialog modal-lg pop-up modal-dialog-scrollable">
    <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
            <h4 class="modal-title">Assign Pattern</h4>
            {{nameFromSecondModal}}
            <button type="button" class="card-link btn-prev-used" (click)="openNestedModal()">Previously Used Pattern</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
            <form [formGroup]="assignPatternForm" (ngSubmit)="onSubmit()" >
                <div class="row g-4">
                    <div class="col-12 col-sm-6 col-md-4">
                        <div class="mb-3">
                            <label for="patternname" class="form-label required">Shift Name</label>
                            <ng-select
                                [items]="patterns"
                                bindLabel="PatternName"
                                bindValue="PatternId"
                                placeholder="Select Shift"
                                formControlName="patternname"
                                [class.is-invalid]="patternname?.invalid && patternname?.touched">
                            </ng-select>
                            <!-- <div *ngIf="selectedEmployee">
                                {{selectedEmployee.email}}
                            </div> -->
                            <div class="invalid-feedback" *ngIf="patternname?.errors?.['required']">
                                Required.
                            </div>
                            </div>
                            <div class="mb-3">
                                <label for="date" class="form-label">Start Date</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            mwlFlatpickr
                                            [altInput]="true"
                                            placeholder="DD-MMM-YYYY"
                                            [dateFormat]="'Y-m-d'"  
                                            [convertModelValue]="true"
                                            formControlName="startdate"
                                        >
                                    <svg class="date-icon-pos"  width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 10H3M16 2V6M8 2V6M7.8 22H16.2C17.8802 22 18.7202 22 19.362 21.673C19.9265 21.3854 20.3854 20.9265 20.673 20.362C21 19.7202 21 18.8802 21 17.2V8.8C21 7.11984 21 6.27976 20.673 5.63803C20.3854 5.07354 19.9265 4.6146 19.362 4.32698C18.7202 4 17.8802 4 16.2 4H7.8C6.11984 4 5.27976 4 4.63803 4.32698C4.07354 4.6146 3.6146 5.07354 3.32698 5.63803C3 6.27976 3 7.11984 3 8.8V17.2C3 18.8802 3 19.7202 3.32698 20.362C3.6146 20.9265 4.07354 21.3854 4.63803 21.673C5.27976 22 6.11984 22 7.8 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
    
                                <div class="invalid-feedback" *ngIf="startdate?.errors?.['required']">
                                    Date is required.
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="inlineCheckbox1">Open Shift</label>
                                <input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1" formControlName="openpattern">
                            </div>
                    </div>

                    <div class="col-12 col-sm-6 col-md-4">
                        <div class="mb-3">
                            <label for="recurring" class="form-label">Recurring</label>
                            <input type="text" 
                                    class="form-control"
                                    formControlName="recurring"
                                    name="recurring"
                                    placeholder="Recurring"
                                    readonly
                                    >
                            <!-- <div class="invalid-feedback" *ngIf="date?.errors?.['required']">
                                Date is required.
                            </div> -->
                        </div>
                        <div class="mb-3">
                            <label for="enddate" class="form-label">End Date</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        mwlFlatpickr
                                        [altInput]="true"
                                        placeholder="DD-MMM-YYYY"
                                        [dateFormat]="'Y-m-d'"  
                                        [convertModelValue]="true"
                                        formControlName="enddate"
                                    >
                                <svg class="date-icon-pos"  width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 10H3M16 2V6M8 2V6M7.8 22H16.2C17.8802 22 18.7202 22 19.362 21.673C19.9265 21.3854 20.3854 20.9265 20.673 20.362C21 19.7202 21 18.8802 21 17.2V8.8C21 7.11984 21 6.27976 20.673 5.63803C20.3854 5.07354 19.9265 4.6146 19.362 4.32698C18.7202 4 17.8802 4 16.2 4H7.8C6.11984 4 5.27976 4 4.63803 4.32698C4.07354 4.6146 3.6146 5.07354 3.32698 5.63803C3 6.27976 3 7.11984 3 8.8V17.2C3 18.8802 3 19.7202 3.32698 20.362C3.6146 20.9265 4.07354 21.3854 4.63803 21.673C5.27976 22 6.11984 22 7.8 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>

                            <div class="invalid-feedback" *ngIf="enddate?.errors?.['required']">
                                Date is required.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label required">Publish to</label>
                            <select class="form-select" aria-label="Default select example" formControlName="publishto">
                                <option selected>Select</option>
                                <option value="1">My Employees</option>
                                <option value="2">My Access</option>
                                <option value="3">My Access+Unallocated Employees</option>
                              </select>
        
                        </div>
                    </div>

                    <div class="col-12 col-sm-6 col-md-4">
                        <div class="mb-3">
                            <label for="noofdaysorweek" class="form-label">No of Day/Weeks</label>
                            <input type="text" 
                                    class="form-control"
                                    formControlName="noofdaysorweek"
                                    name="noofdaysorweek"
                                    placeholder="No of Days/weeks"
                                    readonly
                                    >
                            <!-- <div class="invalid-feedback" *ngIf="date?.errors?.['required']">
                                Date is required.
                            </div> -->
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control shift-desc" rows="5" formControlName="description"
                            ></textarea>
                        </div>
                        
                    </div>
                </div>
                <div class="pattern-schedule" *ngIf="selectedPattern">
            <table class="table table-bordered text-center">
                <thead class="table-light">
                <tr>
                    <th>Series</th>
                    <th *ngFor="let d of [1,2,3,4,5,6,7]">Day {{ d }}</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let group of getGroupedPatternDetails(); let i = index">
                    <td><strong>{{ i + 1 }}</strong></td> <!-- Series -->
                    <td *ngFor="let day of group" class="position-relative">
            <div *ngIf="getShiftDetailsByDay(day); else noShift">
                <div class="d-flex justify-content-center align-items-center gap-1">
                <span>{{ getShiftDetailsByDay(day)?.Shift?.ShiftName }}</span>
                <button 
                    type="button"
                    class="btn btn-sm p-0 popup-trigger"
                    (click)="showPopup(day, $event)">
                    <i class="bi bi-three-dots-vertical"></i>
                </button>
                </div>

                <!-- Floating Popup -->
                <div
                *ngIf="isPopupVisible(day)"
                class="popup-container position-absolute bg-white border shadow p-2 small z-3 rounded"
                style="top: 100%; left: 50%; transform: translateX(-50%); min-width: 150px;"
                >
                <div><strong>Shift:</strong> {{ getShiftDetailsByDay(day)?.Shift?.ShiftName }}</div>
                <div *ngFor="let pc of getShiftDetailsByDay(day)?.PayCodes">
                    <strong>PayCode:</strong> {{ pc.PayCodeName }}
                </div>
                </div>
            </div>

            <ng-template #noShift>
                <span class="text-muted">No Shift</span>
            </ng-template>
            </td>

                    <!-- Fill empty cells if not a full 7 -->
                    <td *ngFor="let _ of [1,2,3,4,5,6,7].slice(group.length)">
                    </td>
                </tr>
                </tbody>
            </table>
            </div>

            </form>
        </div>

        <!-- Modal footer -->
        <!-- <div class="modal-footer"> -->
                <div class="d-grid d-md-flex justify-content-md-end mb-2">
                    <a type="button" class="card-link btn btn-blue-textblue rounded-5 btn-width" data-bs-dismiss="modal">Cancel
                        <svg width="15" height="14" viewBox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M13.5215 1.25L1.52148 13.25M1.52148 1.25L13.5215 13.25" stroke="#0038A8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </a>
                    <button type="submit"  (click)="onSubmit()" class=" card-link btn btn-blue rounded-5"  >Assign
                
                    </button>

            </div>

    </div>
</div>
